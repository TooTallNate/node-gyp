#include <node_api.h>

#if !defined(__wasm__) || (defined(__EMSCRIPTEN__) || defined(__wasi__))
#include <assert.h>
#else
#define assert(x) do { if (!(x)) { __builtin_trap(); } } while (0)
#endif

static napi_value hello(napi_env env, napi_callback_info info) {
  napi_value greeting;
  assert(napi_ok == napi_create_string_utf8(env, "world", NAPI_AUTO_LENGTH, &greeting));
  return greeting;
}

NAPI_MODULE_INIT() {
  napi_value hello_function;
  assert(napi_ok == napi_create_function(env, "hello", NAPI_AUTO_LENGTH,
                                         hello, NULL, &hello_function));
  assert(napi_ok == napi_set_named_property(env, exports, "hello", hello_function));
  return exports;
}
